<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</h1>
    <nav>
      <div id="user-info" class="user-info-bar"></div>
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="projects.html">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</a>
      <a href="post.html" id="post-link">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿</a>
      <a href="my-projects.html">è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a>
      <a href="#" id="change-role-link">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </nav>
  </header>

  <main>
    <section class="filter-section">
      <div style="margin-bottom: 12px;">
        <label for="industry-filter">æ¥­ç•Œ:</label>
        <select id="industry-filter"></select>

        <label for="category-filter">å†…å®¹:</label>
        <select id="category-filter">
          <option value="">ã™ã¹ã¦</option>
          <option value="SDGs">SDGs</option>
          <option value="ãƒ“ã‚¸ã‚³ãƒ³ç³»">ãƒ“ã‚¸ã‚³ãƒ³ç³»</option>
          <option value="ã‚¤ãƒ™ãƒ³ãƒˆ">ã‚¤ãƒ™ãƒ³ãƒˆ</option>
          <option value="ä¼æ¥­ã¨ã®å…±åŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ">ä¼æ¥­ã¨ã®å…±åŒãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</option>
        </select>

        <label for="organization-filter">ä¼æ¥­åãƒ»å›£ä½“å:</label>
        <input type="text" id="organization-filter" placeholder="ä¾‹: æ ªå¼ä¼šç¤¾ã€‡ã€‡" />

        <label for="start-date-filter">é–‹å§‹æ—¥:</label>
        <input type="date" id="start-date-filter" />

        <label for="end-date-filter">çµ‚äº†æ—¥:</label>
        <input type="date" id="end-date-filter" />

        <label for="term-filter">æœŸé–“ã®ç›®å®‰:</label>
        <select id="term-filter">
          <option value="">ã™ã¹ã¦</option>
          <option value="æ˜¥ä¼‘ã¿">æ˜¥ä¼‘ã¿</option>
          <option value="å¤ä¼‘ã¿">å¤ä¼‘ã¿</option>
          <option value="é€šå¹´">é€šå¹´</option>
          <option value="çŸ­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰">çŸ­æœŸï¼ˆ1ãƒ¶æœˆä»¥å†…ï¼‰</option>
          <option value="ä¸­æœŸï¼ˆ1ã€œ3ãƒ¶æœˆï¼‰">ä¸­æœŸï¼ˆ1ã€œ3ãƒ¶æœˆï¼‰</option>
          <option value="é•·æœŸï¼ˆ3ãƒ¶æœˆä»¥ä¸Šï¼‰">é•·æœŸï¼ˆ3ãƒ¶æœˆä»¥ä¸Šï¼‰</option>
        </select>
      </div>

      <div>
        <label for="title-filter">ã‚¿ã‚¤ãƒˆãƒ«:</label>
        <input type="text" id="title-filter" placeholder="ä¾‹: ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ³, èµ·æ¥­, AI ãªã©" />

        <label for="skill-filter">ã‚¹ã‚­ãƒ«è¦ä»¶:</label>
        <input type="text" id="skill-filter" placeholder="ä¾‹: Python, ãƒ‡ã‚¶ã‚¤ãƒ³, å–¶æ¥­ ãªã©" />
      </div>

      <button id="search-button">æ¤œç´¢</button>
    </section>

    <section id="project-list" class="project-grid"></section>
  </main>

  <script>
   // âœ… ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
    document.addEventListener("DOMContentLoaded", () => {
      const role = localStorage.getItem("userRole");
      const name = localStorage.getItem("userName");

      if (!role || !name) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
        window.location.href = "select-role.html";
        return;
      }

      const roleLabel = role === "student" ? "ğŸ‘©â€ğŸ“ å­¦ç”Ÿ" : "ğŸ¢ ä¼æ¥­";
      const userInfo = document.getElementById("user-info");
      if (userInfo) {
        userInfo.textContent = `${roleLabel}ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${name}`;
      }

      // âœ… ãƒ­ã‚°ã‚¢ã‚¦ãƒˆæ©Ÿèƒ½
      const logoutLink = document.getElementById("change-role-link");
      if (logoutLink) {
        logoutLink.addEventListener("click", (e) => {
          e.preventDefault();
          if (confirm("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem("userRole");
            localStorage.removeItem("userName");
            window.location.href = "select-role.html";
          }
        });
      }
    });
 // âœ… ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
    document.addEventListener("DOMContentLoaded", () => {
      const list = document.getElementById("project-list");
      const categoryFilter = document.getElementById("category-filter");
      const industryFilter = document.getElementById("industry-filter");
      const termFilter = document.getElementById("term-filter");
      const orgFilter = document.getElementById("organization-filter");
      const titleFilter = document.getElementById("title-filter");
      const skillFilter = document.getElementById("skill-filter");
      const startDateFilter = document.getElementById("start-date-filter");
      const endDateFilter = document.getElementById("end-date-filter");
      const searchBtn = document.getElementById("search-button");

      function renderProjects(projects) {
        list.innerHTML = "";

        if (projects.length === 0) {
          list.innerHTML = `
            <div class="empty-message">
              <p>æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
            </div>`;
          return;
        }

        projects.forEach(project => {
          const card = document.createElement("div");
          card.className = "project";
          card.innerHTML = `
            <h3>${project.title}</h3>
            <p>${project.description}</p>
            <p><strong>æ¥­ç•Œ:</strong> ${project.industry}</p>
            <p><strong>å†…å®¹:</strong> ${project.category}</p>
            <p><strong>ä¼æ¥­å:</strong> ${project.organization}</p>
            <a href="detail.html?id=${project.id}" class="view-btn">è©³ç´°ã‚’è¦‹ã‚‹</a>
          `;
          list.appendChild(card);
        });
      }

      function filterProjects() {
        const allProjects = JSON.parse(localStorage.getItem("projects") || "[]");

        const category = categoryFilter.value;
        const industry = industryFilter.value;
        const term = termFilter.value;
        const org = orgFilter.value.trim();
        const title = titleFilter.value.trim();
        const skill = skillFilter.value.trim();
        const startDate = startDateFilter.value;
        const endDate = endDateFilter.value;

        const filtered = allProjects.filter(p => {
          const [start, end] = (p.duration || "ã€œ").split("ã€œ").map(d => new Date(d));
          return (!category || p.category === category) &&
                 (!industry || p.industry === industry) &&
                 (!term || p.term_label === term) &&
                 (!org || p.organization.includes(org)) &&
                 (!title || p.title.includes(title)) &&
                 (!skill || (p.skills && p.skills.includes(skill))) &&
                 (!startDate || start >= new Date(startDate)) &&
                 (!endDate || end <= new Date(endDate));
        });

        renderProjects(filtered);
      }

      searchBtn.addEventListener("click", filterProjects);

      // åˆå›è¡¨ç¤ºï¼šå…¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¡¨ç¤º
      renderProjects(JSON.parse(localStorage.getItem("projects") || "[]"));
    });
  </script>

  <script src="script.js"></script>
</body>
</html>
