<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>è‡ªç¤¾ã®æŠ•ç¨¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>è‡ªç¤¾ã®æŠ•ç¨¿ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</h1>
    <nav>
<div id="user-info" class="user-info-bar"></div>

      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="projects.html">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</a>
      <a href="post.html" id="post-link">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿</a>
      <a href="company-projects.html">è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a>
      <a href="#" id="change-role-link">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </nav>
  </header>

  <main>
    <section class="user-intro">
      <h2>ã‚ˆã†ã“ãã€ã‚ãªãŸãŒæŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§ã¸</h2>
      <p>ã“ã“ã§ã¯ã€è‡ªç¤¾ãŒæŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ç¢ºèªãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã§ãã¾ã™ã€‚</p>
    </section>

    <section class="user-stats">
      <p>ğŸ“Œ æŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°ï¼š<span id="project-count">0</span></p>
      <p>ğŸ•’ æœ€çµ‚æŠ•ç¨¿æ—¥ï¼š<span id="last-post-date">--</span></p>
    </section>

    <section id="my-projects-list" class="project-grid"></section>
  </main>

  <script src="script.js"></script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const role = localStorage.getItem("userRole");
      const name = localStorage.getItem("userName");

      if (!role || !name || role !== "company") {
        alert("ã“ã®ãƒšãƒ¼ã‚¸ã«ã¯ä¼æ¥­ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚");
        window.location.href = "select-role.html";
        return;
      }

      const userInfo = document.getElementById("user-info");
      if (userInfo) {
        userInfo.textContent = `ğŸ¢ ä¼æ¥­ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${name}`;
      }

      const logoutLink = document.getElementById("change-role-link");
      if (logoutLink) {
        logoutLink.addEventListener("click", (e) => {
          e.preventDefault();
          if (confirm("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem("userRole");
            localStorage.removeItem("userName");
            window.location.href = "select-role.html";
          }
        });
      }

      const list = document.getElementById("my-projects-list");
      const count = document.getElementById("project-count");
      const lastDate = document.getElementById("last-post-date");

      const userName = localStorage.getItem("userName");
      let projects = JSON.parse(localStorage.getItem("projects") || "[]");
      const myProjects = projects.filter(p => p.author === userName);

      count.textContent = myProjects.length;
      if (myProjects.length > 0) {
        const dates = myProjects.map(p => new Date(parseInt(p.id)));
        const latest = new Date(Math.max(...dates));
        lastDate.textContent = latest.toLocaleDateString();
      }

      if (myProjects.length === 0) {
        list.innerHTML = `
          <div class="empty-message">
            <img src="https://cdn-icons-png.flaticon.com/512/4076/4076503.png" alt="No Projects">
            <p>ã¾ã æŠ•ç¨¿ã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
          </div>`;
        return;
      }

    myProjects.forEach(project => {
      const div = document.createElement("div");
      div.className = "project-card";
      div.innerHTML = `
        <h3>${project.title}</h3>
        <p>${project.description}</p>
        <p><strong>æ¥­ç•Œ:</strong> ${project.industry}</p>
        <p><strong>å†…å®¹:</strong> ${project.category}</p>
        <p><strong>æœŸé–“:</strong> ${project.duration}</p>
        <p><strong>ä¼æ¥­å:</strong> ${project.organization}</p>
        <a href="detail.html?id=${project.id}" class="btn">è©³ç´°ã‚’è¦‹ã‚‹</a>
        <a href="detail.html?edit=${project.id}" class="btn">ç·¨é›†</a>
        <button class="delete-btn" data-id="${project.id}">å‰Šé™¤</button>
      `;
      list.appendChild(div);
    });

    list.addEventListener("click", function (e) {
      if (e.target.classList.contains("delete-btn")) {
        const id = e.target.getAttribute("data-id");
        if (confirm("æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
          let projects = JSON.parse(localStorage.getItem("projects") || "[]");
          projects = projects.filter(p => p.id !== id);
          localStorage.setItem("projects", JSON.stringify(projects));
          location.reload();
        }
      }
    });
  });
</script>

</body>
</html>
