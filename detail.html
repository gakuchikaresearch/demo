<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header>
    <h1>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè©³ç´°</h1>
    <nav>
<div id="user-info" class="user-info-bar"></div>

      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <a href="projects.html">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§</a>
      <a href="post.html" id="post-link">ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæŠ•ç¨¿</a>
      <a href="my-projects.html">è‡ªåˆ†ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</a>
      <a href="#" id="change-role-link">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
    </nav>
  </header>

  <main>
    <div id="project-detail" class="project-detail">
      <!-- JavaScriptã§å†…å®¹ã‚’æŒ¿å…¥ -->
    </div>
  </main>

 <script src="script.js"></script>
  <script>
       document.addEventListener("DOMContentLoaded", () => {
      const role = localStorage.getItem("userRole");
      const userName = localStorage.getItem("userName");

      if (!role || !userName) {
        alert("ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚");
        window.location.href = "select-role.html";
        return;
      }

      const roleLabel = role === "student" ? "ğŸ‘©â€ğŸ“ å­¦ç”Ÿ" : "ğŸ¢ ä¼æ¥­";
      const userInfo = document.getElementById("user-info");
      if (userInfo) {
        userInfo.textContent = `${roleLabel}ã¨ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ä¸­ï¼š${userName}`;
      }

      const logoutLink = document.getElementById("change-role-link");
      if (logoutLink) {
        logoutLink.addEventListener("click", (e) => {
          e.preventDefault();
          if (confirm("ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
            localStorage.removeItem("userRole");
            localStorage.removeItem("userName");
            window.location.href = "select-role.html";
          }
        });
      }
      const params = new URLSearchParams(window.location.search);
      const id = params.get("id");
      const projects = JSON.parse(localStorage.getItem("projects") || "[]");
      const project = projects.find(p => p.id === id);

      const container = document.getElementById("project-detail");
      if (!project) {
        container.innerHTML = "<p>ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>";
        return;
      }

      const role = localStorage.getItem("userRole");
      const userName = localStorage.getItem("userName");
      const favorites = JSON.parse(localStorage.getItem(`favorites_${userName}`) || "[]");
      const isFavorite = favorites.includes(project.id);

      const favoriteBtn = (role === "student") ? `
        <button id="favorite-btn" class="favorite-btn ${isFavorite ? "added" : ""}" data-id="${project.id}">
          ${isFavorite ? "â˜… ãŠæ°—ã«å…¥ã‚Šè§£é™¤" : "â˜† ãŠæ°—ã«å…¥ã‚Šè¿½åŠ "}
        </button>` : "";

      container.innerHTML = `
        <h2>${project.title}</h2>
        <p><span class="label">æ¦‚è¦:</span> ${project.description}</p>
        <p><span class="label">æ¥­ç•Œ:</span> ${project.industry}</p>
        <p><span class="label">å†…å®¹:</span> ${project.category}</p>
        <p><span class="label">ä¼æ¥­å:</span> ${project.organization}</p>
        <p><span class="label">ä½œæˆè€…:</span> ${project.author}</p>
        <p><span class="label">æœŸé–“:</span> ${project.duration}</p>
        <p><span class="label">æœŸé–“ã®ç›®å®‰:</span> ${project.term_label}</p>
        <p><span class="label">ã‚¹ã‚­ãƒ«è¦ä»¶:</span> ${project.skills || "ç‰¹ã«ãªã—"}</p>
        <p><span class="label">å‹Ÿé›†äººæ•°:</span> ${project.members}</p>
        <p><span class="label">é€£çµ¡å…ˆ:</span> ${project.contact || "æœªè¨˜å…¥"}</p>
        ${favoriteBtn}
      `;

      const favBtn = document.getElementById("favorite-btn");
      if (favBtn) {
        favBtn.addEventListener("click", () => {
          let favs = JSON.parse(localStorage.getItem(`favorites_${userName}`) || "[]");
          const isRemoving = favs.includes(id);

          if (isRemoving) {
            favs = favs.filter(pid => pid !== id);
          } else {
            favs.push(id);
          }

          localStorage.setItem(`favorites_${userName}`, JSON.stringify(favs));

          favBtn.classList.toggle("added", !isRemoving);
          favBtn.textContent = isRemoving ? "â˜† ãŠæ°—ã«å…¥ã‚Šè¿½åŠ " : "â˜… ãŠæ°—ã«å…¥ã‚Šè§£é™¤";
        });
      }
    });
  </script>
  <script src="script.js"></script>
</body>
</html>
